generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// ユーザー（学生および管理者）
model User {
  id             String       @id @default(uuid())
  studentNumber  String       @unique
  password       String
  name           String
  role           String       @default("STUDENT")
  
  attendances    Attendance[]
  scores         Score[]
}

// 科目
model Subject {
  id              String   @id @default(uuid())
  name            String
  units           Int
  isStudyCredit   Boolean  @default(false)
  
  baseTotalClasses Int
  cancelledClasses Int     @default(0)
  makeupClasses    Int     @default(0)

  attendances     Attendance[]
  scores          Score[]
  exams           Exam[]
}

// 欠席記録
model Attendance {
  id        String   @id @default(uuid())
  userId    String
  subjectId String
  date      DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}

// テスト定義
model Exam {
  id        String  @id @default(uuid())
  subjectId String
  name      String
  maxScore  Int     @default(100)
  
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  scores    Score[]
}

// テストの点数
model Score {
  id        String  @id @default(uuid())
  userId    String
  examId    String?
  subjectId String
  value     Int

  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  exam      Exam?   @relation(fields: [examId], references: [id], onDelete: Cascade)
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}