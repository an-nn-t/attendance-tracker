generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ユーザー（生徒・管理者）
model User {
  id           String      @id @default(uuid())
  attendanceNo Int         @unique // 出席番号（ログインIDとして使用）
  name         String      // 名前（ニックネーム可）
  password     String      // パスワード（ハッシュ化して保存）
  role         Role        @default(STUDENT) // 生徒か管理者か
  absences     Absence[]   // このユーザーの欠席記録
  testScores   TestScore[] // このユーザーのテスト点数
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

enum Role {
  STUDENT // 生徒
  ADMIN   // 管理者
}

// 科目（管理者が登録）
model Subject {
  id            String      @id @default(uuid())
  name          String      // 科目名
  credits       Int         // 単位数
  isGakushu     Boolean     @default(false) // 学修単位かどうか
  canceledCount Int         @default(0)     // 休講回数
  makeupCount   Int         @default(0)     // 補講回数
  absences      Absence[]   // この科目の欠席記録
  testScores    TestScore[] // この科目のテスト点数
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

// 欠席記録（生徒が記録）
model Absence {
  id        String   @id @default(uuid())
  date      DateTime // 欠席した日
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  subjectId String
  createdAt DateTime @default(now())
}

// テストの点数
model TestScore {
  id        String   @id @default(uuid())
  term      String   // 「前期中間」「前期期末」などのテストの種類
  score     Int      // 取った点数
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  subjectId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}